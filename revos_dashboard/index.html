<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>REVOS War Room</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #080c10;
    --surface: #0d1117;
    --surface2: #111820;
    --border: #1e2d3d;
    --green: #00ff88;
    --yellow: #ffcc00;
    --red: #ff3b5c;
    --blue: #00aaff;
    --text: #e2e8f0;
    --muted: #5a7085;
    --font-mono: 'Space Mono', monospace;
    --font-display: 'Syne', sans-serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font-display);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 0;
  }

  /* Scanline overlay */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,255,136,0.015) 2px, rgba(0,255,136,0.015) 4px);
    pointer-events: none;
    z-index: 1000;
  }

  .header {
    border-bottom: 1px solid var(--border);
    padding: 20px 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: var(--surface);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .logo {
    font-family: var(--font-mono);
    font-size: 13px;
    font-weight: 700;
    color: var(--green);
    letter-spacing: 4px;
    text-transform: uppercase;
  }

  .logo span { color: var(--muted); }

  .week-badge {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--muted);
    border: 1px solid var(--border);
    padding: 4px 12px;
    border-radius: 4px;
  }

  .live-dot {
    display: inline-block;
    width: 7px;
    height: 7px;
    background: var(--green);
    border-radius: 50%;
    margin-right: 8px;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(0,255,136,0.4); }
    50% { opacity: 0.6; box-shadow: 0 0 0 6px rgba(0,255,136,0); }
  }

  .main {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 0;
    min-height: calc(100vh - 65px);
  }

  .left-panel {
    padding: 28px 32px;
    border-right: 1px solid var(--border);
    overflow-y: auto;
  }

  .right-panel {
    padding: 28px 24px;
    overflow-y: auto;
    background: var(--surface);
  }

  /* TABS */
  .tabs {
    display: flex;
    gap: 4px;
    margin-bottom: 28px;
    border-bottom: 1px solid var(--border);
  }

  .tab {
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 10px 20px;
    cursor: pointer;
    color: var(--muted);
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
    background: none;
    border-top: none;
    border-left: none;
    border-right: none;
  }

  .tab:hover { color: var(--text); }
  .tab.active { color: var(--green); border-bottom-color: var(--green); }

  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* SECTION HEADERS */
  .section-label {
    font-family: var(--font-mono);
    font-size: 10px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  /* COMPANY HEALTH GRID */
  .health-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 32px;
  }

  .health-card {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.2s;
  }

  .health-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--status-color, var(--muted));
    transition: background 0.3s;
  }

  .health-card.green { --status-color: var(--green); border-color: rgba(0,255,136,0.15); }
  .health-card.yellow { --status-color: var(--yellow); border-color: rgba(255,204,0,0.15); }
  .health-card.red { --status-color: var(--red); border-color: rgba(255,59,92,0.15); }

  .health-metric-name {
    font-size: 11px;
    color: var(--muted);
    margin-bottom: 8px;
    font-family: var(--font-mono);
  }

  .health-value {
    font-size: 28px;
    font-weight: 800;
    color: var(--text);
    line-height: 1;
    margin-bottom: 4px;
  }

  .health-target {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--muted);
  }

  .status-badge {
    position: absolute;
    top: 14px;
    right: 14px;
    font-family: var(--font-mono);
    font-size: 9px;
    letter-spacing: 1px;
    padding: 3px 8px;
    border-radius: 3px;
    font-weight: 700;
  }

  .status-badge.green { background: rgba(0,255,136,0.1); color: var(--green); }
  .status-badge.yellow { background: rgba(255,204,0,0.1); color: var(--yellow); }
  .status-badge.red { background: rgba(255,59,92,0.1); color: var(--red); }

  /* FOUNDER SCORECARDS */
  .founder-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 32px;
  }

  .founder-card {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    transition: border-color 0.2s;
  }

  .founder-card:hover { border-color: rgba(0,255,136,0.3); }

  .founder-name {
    font-size: 16px;
    font-weight: 800;
    color: var(--text);
    margin-bottom: 2px;
  }

  .founder-role {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--green);
    letter-spacing: 2px;
    margin-bottom: 16px;
  }

  .metric-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
    font-size: 12px;
  }

  .metric-row:last-child { border-bottom: none; }
  .metric-row .label { color: var(--muted); }
  .metric-row .val { font-family: var(--font-mono); font-weight: 700; }
  .metric-row .val.green { color: var(--green); }
  .metric-row .val.yellow { color: var(--yellow); }
  .metric-row .val.red { color: var(--red); }

  /* WEEKLY TREND CHART */
  .trend-chart {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 32px;
  }

  .chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .chart-title {
    font-weight: 700;
    font-size: 14px;
  }

  .chart-legend {
    display: flex;
    gap: 16px;
    font-family: var(--font-mono);
    font-size: 10px;
  }

  .legend-item { display: flex; align-items: center; gap: 6px; color: var(--muted); }
  .legend-dot { width: 8px; height: 8px; border-radius: 50%; }

  .chart-area {
    position: relative;
    height: 120px;
    display: flex;
    align-items: flex-end;
    gap: 8px;
  }

  .bar-group {
    flex: 1;
    display: flex;
    gap: 3px;
    align-items: flex-end;
    flex-direction: row;
  }

  .bar {
    flex: 1;
    border-radius: 3px 3px 0 0;
    transition: height 0.5s ease;
    cursor: pointer;
    position: relative;
  }

  .bar:hover::after {
    content: attr(data-val);
    position: absolute;
    top: -22px;
    left: 50%;
    transform: translateX(-50%);
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text);
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 2px 6px;
    border-radius: 3px;
    white-space: nowrap;
  }

  .bar.filipe { background: var(--green); }
  .bar.loa { background: var(--blue); }
  .bar.clinton { background: var(--yellow); }

  .chart-weeks {
    display: flex;
    gap: 8px;
    margin-top: 8px;
  }

  .week-label {
    flex: 1;
    text-align: center;
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--muted);
  }

  /* DESIGN PARTNER TRACKER */
  .partner-tracker {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 32px;
  }

  .partner-progress {
    display: flex;
    gap: 8px;
    margin: 16px 0;
  }

  .partner-slot {
    flex: 1;
    height: 40px;
    border-radius: 6px;
    border: 1px dashed var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--muted);
    transition: all 0.3s;
    cursor: pointer;
  }

  .partner-slot.filled {
    background: rgba(0,255,136,0.1);
    border: 1px solid var(--green);
    color: var(--green);
    font-weight: 700;
  }

  .partner-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 16px;
  }

  .partner-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 13px;
  }

  .partner-status {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .partner-name { flex: 1; font-weight: 600; }
  .partner-stage { font-family: var(--font-mono); font-size: 10px; color: var(--muted); }

  /* ALERTS */
  .alerts-panel {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 28px;
  }

  .alert-item {
    display: flex;
    gap: 12px;
    padding: 10px 0;
    border-bottom: 1px solid var(--border);
    align-items: flex-start;
    animation: slideIn 0.3s ease;
  }

  .alert-item:last-child { border-bottom: none; }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .alert-icon {
    font-size: 14px;
    flex-shrink: 0;
    margin-top: 1px;
  }

  .alert-text { font-size: 12px; color: var(--text); line-height: 1.5; }
  .alert-meta { font-family: var(--font-mono); font-size: 10px; color: var(--muted); margin-top: 2px; }

  /* SUBMIT FORM */
  .report-form {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 24px;
  }

  .form-row {
    margin-bottom: 16px;
  }

  .form-label {
    font-family: var(--font-mono);
    font-size: 10px;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
    display: block;
    margin-bottom: 8px;
  }

  .form-control {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px 14px;
    color: var(--text);
    font-family: var(--font-display);
    font-size: 13px;
    transition: border-color 0.2s;
    resize: vertical;
  }

  .form-control:focus {
    outline: none;
    border-color: var(--green);
  }

  select.form-control {
    appearance: none;
    cursor: pointer;
  }

  .btn-submit {
    width: 100%;
    background: var(--green);
    color: #000;
    border: none;
    padding: 14px;
    border-radius: 6px;
    font-family: var(--font-mono);
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 3px;
    cursor: pointer;
    text-transform: uppercase;
    transition: all 0.2s;
    margin-top: 8px;
  }

  .btn-submit:hover { background: #00cc6a; transform: translateY(-1px); }
  .btn-submit:active { transform: translateY(0); }

  /* REPORTS FEED */
  .reports-feed {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .report-card {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px;
    transition: border-color 0.2s;
    animation: slideIn 0.3s ease;
  }

  .report-card:hover { border-color: rgba(0,255,136,0.2); }

  .report-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .report-role {
    font-weight: 800;
    font-size: 14px;
  }

  .report-role.Filipe { color: var(--green); }
  .report-role.Loa { color: var(--blue); }
  .report-role.Clinton { color: var(--yellow); }

  .report-time {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--muted);
  }

  .report-field {
    margin-bottom: 8px;
  }

  .report-field-label {
    font-family: var(--font-mono);
    font-size: 9px;
    letter-spacing: 2px;
    color: var(--muted);
    text-transform: uppercase;
    margin-bottom: 3px;
  }

  .report-field-value {
    font-size: 12px;
    color: var(--text);
    line-height: 1.5;
  }

  /* RIGHT PANEL */
  .right-section-title {
    font-weight: 700;
    font-size: 13px;
    margin-bottom: 14px;
    color: var(--text);
  }

  /* COMMITMENTS */
  .commitment-block {
    margin-bottom: 20px;
  }

  .commitment-name {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 2px;
    margin-bottom: 8px;
  }

  .commitment-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    margin-bottom: 6px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .commitment-item:hover { border-color: var(--green); }

  .commitment-item input[type="checkbox"] {
    width: 14px;
    height: 14px;
    accent-color: var(--green);
    cursor: pointer;
    flex-shrink: 0;
  }

  .commitment-text { flex: 1; }
  .commitment-text.done { text-decoration: line-through; color: var(--muted); }

  /* WEEK SELECTOR */
  .week-nav {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
  }

  .week-nav button {
    background: var(--surface2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 6px 14px;
    border-radius: 4px;
    cursor: pointer;
    font-family: var(--font-mono);
    font-size: 11px;
    transition: all 0.2s;
  }

  .week-nav button:hover { border-color: var(--green); color: var(--green); }

  .current-week {
    flex: 1;
    text-align: center;
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--green);
    font-weight: 700;
  }

  /* PHASE INDICATOR */
  .phase-banner {
    background: linear-gradient(135deg, rgba(0,255,136,0.08), rgba(0,170,255,0.04));
    border: 1px solid rgba(0,255,136,0.2);
    border-radius: 8px;
    padding: 16px 20px;
    margin-bottom: 28px;
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .phase-num {
    font-family: var(--font-mono);
    font-size: 36px;
    font-weight: 700;
    color: var(--green);
    line-height: 1;
    opacity: 0.4;
  }

  .phase-details {}
  .phase-name { font-size: 16px; font-weight: 800; }
  .phase-desc { font-size: 12px; color: var(--muted); margin-top: 4px; }

  .phase-weeks {
    margin-left: auto;
    text-align: right;
  }

  .phase-weeks-label { font-family: var(--font-mono); font-size: 10px; color: var(--muted); }
  .phase-weeks-val { font-family: var(--font-mono); font-size: 20px; color: var(--text); font-weight: 700; }

  /* MODAL */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    z-index: 500;
    display: none;
    align-items: center;
    justify-content: center;
  }

  .modal-overlay.active { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 28px;
    width: 480px;
    max-width: 90vw;
    max-height: 90vh;
    overflow-y: auto;
  }

  .modal-title {
    font-size: 18px;
    font-weight: 800;
    margin-bottom: 20px;
  }

  .modal-close {
    float: right;
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 20px;
    line-height: 1;
  }

  /* TOAST */
  .toast {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background: var(--surface);
    border: 1px solid var(--green);
    border-radius: 8px;
    padding: 14px 20px;
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--green);
    z-index: 1000;
    transform: translateY(80px);
    opacity: 0;
    transition: all 0.3s;
  }

  .toast.show {
    transform: translateY(0);
    opacity: 1;
  }

  /* PARTNER MODAL FORM */
  .partner-form { display: flex; flex-direction: column; gap: 14px; }

  .stage-options {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }

  .stage-opt {
    padding: 6px 14px;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-family: var(--font-mono);
    font-size: 10px;
    cursor: pointer;
    color: var(--muted);
    transition: all 0.2s;
    background: none;
  }

  .stage-opt:hover, .stage-opt.active {
    border-color: var(--green);
    color: var(--green);
    background: rgba(0,255,136,0.08);
  }

  .btn-add {
    background: rgba(0,255,136,0.1);
    border: 1px solid var(--green);
    color: var(--green);
    padding: 10px 18px;
    border-radius: 6px;
    cursor: pointer;
    font-family: var(--font-mono);
    font-size: 11px;
    letter-spacing: 2px;
    transition: all 0.2s;
  }

  .btn-add:hover { background: rgba(0,255,136,0.2); }

  .btn-delete {
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 14px;
    padding: 0 4px;
    transition: color 0.2s;
  }

  .btn-delete:hover { color: var(--red); }

  /* EMPTY STATE */
  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--muted);
    font-family: var(--font-mono);
    font-size: 12px;
  }

  .empty-state .icon { font-size: 32px; margin-bottom: 12px; opacity: 0.4; }

  /* RESPONSIVE */
  @media (max-width: 900px) {
    .main { grid-template-columns: 1fr; }
    .right-panel { border-top: 1px solid var(--border); }
    .health-grid { grid-template-columns: repeat(2, 1fr); }
    .founder-grid { grid-template-columns: 1fr; }
  }

  @media (max-width: 600px) {
    .health-grid { grid-template-columns: 1fr; }
    .header { padding: 14px 16px; }
    .left-panel, .right-panel { padding: 20px 16px; }
  }
</style>
</head>
<body>

<div class="header">
  <div class="logo">REVOS <span>/ WAR ROOM</span></div>
  <div style="display:flex;align-items:center;gap:16px;">
    <span style="font-family:var(--font-mono);font-size:11px;color:var(--muted)" id="current-date"></span>
    <div class="week-badge"><span class="live-dot"></span>LIVE</div>
  </div>
</div>

<div class="main">
  <!-- LEFT: Main Content -->
  <div class="left-panel">
    <!-- Phase Banner -->
    <div class="phase-banner" id="phase-banner">
      <div class="phase-num" id="phase-num">1</div>
      <div class="phase-details">
        <div class="phase-name" id="phase-name">Foundation</div>
        <div class="phase-desc" id="phase-desc">Define category. Build proof. First demonstration.</div>
      </div>
      <div class="phase-weeks">
        <div class="phase-weeks-label">WEEK</div>
        <div class="phase-weeks-val" id="phase-week-display">‚Äî</div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('dashboard', this)">Dashboard</button>
      <button class="tab" onclick="switchTab('reports', this)">Reports</button>
      <button class="tab" onclick="switchTab('submit', this)">Submit Report</button>
      <button class="tab" onclick="switchTab('partners', this)">Design Partners</button>
    </div>

    <!-- DASHBOARD TAB -->
    <div id="tab-dashboard" class="tab-content active">
      <div class="section-label">Company Health</div>
      <div class="health-grid" id="health-grid">
        <!-- Dynamically populated -->
      </div>

      <div class="section-label">Founder Scorecards</div>
      <div class="founder-grid" id="founder-grid">
        <!-- Dynamically populated -->
      </div>

      <div class="section-label">Weekly Output Trend</div>
      <div class="trend-chart">
        <div class="chart-header">
          <div class="chart-title">Reports Submitted Per Week</div>
          <div class="chart-legend">
            <div class="legend-item"><div class="legend-dot" style="background:var(--green)"></div>Filipe</div>
            <div class="legend-item"><div class="legend-dot" style="background:var(--blue)"></div>Loa</div>
            <div class="legend-item"><div class="legend-dot" style="background:var(--yellow)"></div>Clinton</div>
          </div>
        </div>
        <div class="chart-area" id="chart-area"></div>
        <div class="chart-weeks" id="chart-weeks"></div>
      </div>
    </div>

    <!-- REPORTS TAB -->
    <div id="tab-reports" class="tab-content">
      <div id="reports-feed" class="reports-feed">
        <div class="empty-state"><div class="icon">üìã</div>Loading reports...</div>
      </div>
    </div>

    <!-- SUBMIT TAB -->
    <div id="tab-submit" class="tab-content">
      <div class="report-form">
        <div class="form-row">
          <label class="form-label">Your Role</label>
          <select id="form-role" class="form-control">
            <option value="Filipe">Filipe ‚Äî CRO (Revenue)</option>
            <option value="Loa">Loa ‚Äî CCO (Market Authority)</option>
            <option value="Clinton">Clinton ‚Äî COO (Operations)</option>
          </select>
        </div>
        <div class="form-row">
          <label class="form-label">Outputs Shipped (What now exists in the world?)</label>
          <textarea id="form-outputs" class="form-control" rows="3" placeholder="e.g. Updated pricing deck v2, Ran 3 discovery calls, Published LinkedIn article..."></textarea>
        </div>
        <div class="form-row">
          <label class="form-label">Learnings (Observation ‚Üí Meaning)</label>
          <textarea id="form-learnings" class="form-control" rows="2" placeholder="e.g. Founders hate forecasting ‚Üí Core pain is embarrassment, not accuracy"></textarea>
        </div>
        <div class="form-row">
          <label class="form-label">Blockers (Problem ‚Üí Who must solve ‚Üí By when)</label>
          <textarea id="form-blockers" class="form-control" rows="2" placeholder="e.g. Demo confusing ‚Üí Loa ‚Üí Wednesday"></textarea>
        </div>
        <div class="form-row">
          <label class="form-label">Key Metrics This Week</label>
          <textarea id="form-metrics" class="form-control" rows="2" placeholder="e.g. 27 outbound convos, 11 discovery calls, 2 offers made"></textarea>
        </div>
        <div class="form-row">
          <label class="form-label">Next Week's Commitments (3 max ‚Äî deliverables only)</label>
          <textarea id="form-commitments" class="form-control" rows="2" placeholder="e.g. Homepage live with pipeline diagram, 10 discovery calls booked"></textarea>
        </div>
        <button class="btn-submit" onclick="submitReport()">SUBMIT REPORT ‚Üí</button>
      </div>
    </div>

    <!-- PARTNERS TAB -->
    <div id="tab-partners" class="tab-content">
      <div class="partner-tracker">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
          <div>
            <div style="font-size:16px;font-weight:800;">Design Partner Progress</div>
            <div style="font-family:var(--font-mono);font-size:11px;color:var(--muted);margin-top:4px;">Target: 5 signed companies before engineers hired</div>
          </div>
          <button class="btn-add" onclick="openPartnerModal()">+ ADD PARTNER</button>
        </div>
        <div class="partner-progress" id="partner-slots"></div>
        <div class="partner-list" id="partner-list">
          <div class="empty-state"><div class="icon">üéØ</div>No design partners yet. Close the first deal.</div>
        </div>
      </div>

      <!-- Launch Readiness -->
      <div class="section-label">Launch Readiness Checklist</div>
      <div id="launch-checklist" style="display:flex;flex-direction:column;gap:8px;"></div>
    </div>

  </div>

  <!-- RIGHT: Sidebar -->
  <div class="right-panel">
    <!-- Accountability Alerts -->
    <div class="right-section-title">‚ö° Accountability Alerts</div>
    <div class="alerts-panel">
      <div id="alerts-list">
        <div class="empty-state" style="padding:20px 0;"><div class="icon" style="font-size:20px;">‚úÖ</div>No active alerts</div>
      </div>
    </div>

    <!-- Week Navigation -->
    <div class="right-section-title">Weekly Commitments</div>
    <div class="week-nav">
      <button onclick="changeWeek(-1)">‚Üê</button>
      <div class="current-week" id="week-display">WEEK 1</div>
      <button onclick="changeWeek(1)">‚Üí</button>
    </div>

    <!-- Commitments -->
    <div id="commitments-panel"></div>

    <div style="height:24px;"></div>

    <!-- Blockers Board -->
    <div class="right-section-title">üöß Active Blockers</div>
    <div id="blockers-board" style="display:flex;flex-direction:column;gap:8px;">
      <div class="empty-state" style="font-family:var(--font-mono);font-size:11px;color:var(--muted);text-align:center;padding:16px 0;">No active blockers</div>
    </div>
  </div>
</div>

<!-- Add Partner Modal -->
<div class="modal-overlay" id="partner-modal">
  <div class="modal">
    <button class="modal-close" onclick="closePartnerModal()">‚úï</button>
    <div class="modal-title">Add Design Partner</div>
    <div class="partner-form">
      <div class="form-row">
        <label class="form-label">Company Name</label>
        <input type="text" id="p-name" class="form-control" placeholder="e.g. Acme Corp">
      </div>
      <div class="form-row">
        <label class="form-label">Contact Name</label>
        <input type="text" id="p-contact" class="form-control" placeholder="e.g. Jane Smith">
      </div>
      <div class="form-row">
        <label class="form-label">Stage</label>
        <div class="stage-options" id="stage-options">
          <button class="stage-opt" onclick="selectStage(this,'Outreach')">Outreach</button>
          <button class="stage-opt" onclick="selectStage(this,'Discovery Call')">Discovery Call</button>
          <button class="stage-opt" onclick="selectStage(this,'Offer Sent')">Offer Sent</button>
          <button class="stage-opt" onclick="selectStage(this,'Signed')">Signed</button>
          <button class="stage-opt" onclick="selectStage(this,'Active')">Active</button>
        </div>
      </div>
      <div class="form-row">
        <label class="form-label">Notes</label>
        <textarea id="p-notes" class="form-control" rows="2" placeholder="Key context, pain points, next action..."></textarea>
      </div>
      <button class="btn-submit" onclick="savePartner()">SAVE PARTNER ‚Üí</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ‚îÄ CONFIGURATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const supabaseUrl = "https://zmfmvaedfrdwldhtfjmm.supabase.co";
const supabaseKey = "sb_publishable_Wgamoaf3a1dlzdH9UFc9Pg_ziGt7Cwh";
const db = supabase.createClient(supabaseUrl, supabaseKey);

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let allReports = [];
let allPartners = [];
let currentWeekOffset = 0;
let selectedStage = '';
let launchStartDate = null;

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function init() {
  document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { weekday:'short', month:'short', day:'numeric', year:'numeric' });
  
  // Load launch start from local storage (or default to 12 weeks ago from now for demo)
  const stored = localStorage.getItem('revos_launch_start');
  if (stored) {
    launchStartDate = new Date(stored);
  } else {
    launchStartDate = new Date();
    localStorage.setItem('revos_launch_start', launchStartDate.toISOString());
  }

  updateWeekDisplay();
  updatePhase();
  await loadReports();
  await loadPartners();
  renderDashboard();
  renderLaunchChecklist();
}

// ‚îÄ‚îÄ‚îÄ WEEK LOGIC ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getCurrentWeekNumber() {
  const now = new Date();
  const diff = now - launchStartDate;
  return Math.max(1, Math.ceil(diff / (7 * 24 * 60 * 60 * 1000)));
}

function changeWeek(dir) {
  currentWeekOffset += dir;
  updateWeekDisplay();
  renderCommitments();
}

function updateWeekDisplay() {
  const weekNum = getCurrentWeekNumber() + currentWeekOffset;
  document.getElementById('week-display').textContent = `WEEK ${Math.max(1, weekNum)}`;
  document.getElementById('phase-week-display').textContent = getCurrentWeekNumber();
}

function updatePhase() {
  const week = getCurrentWeekNumber();
  let phase = 1, name = 'Foundation', desc = 'Define category. Build proof. First demonstration.';
  if (week >= 4 && week <= 8) { phase = 2; name = 'Market Entry'; desc = 'Sell BEFORE software exists. Close first design partners.'; }
  if (week >= 9) { phase = 3; name = 'Pre-Software Validation'; desc = 'Prove demand. Prepare engineering spec. Launch ready.'; }

  document.getElementById('phase-num').textContent = phase;
  document.getElementById('phase-name').textContent = name;
  document.getElementById('phase-desc').textContent = desc;
}

// ‚îÄ‚îÄ‚îÄ SUPABASE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadReports() {
  try {
    const { data, error } = await db.from('founder_reports').select('*').order('created_at', { ascending: false });
    if (error) throw error;
    allReports = data || [];
    renderReports();
    renderDashboard();
    renderAlerts();
  } catch (e) {
    console.warn('Supabase error (reports):', e.message);
    allReports = [];
    renderReports();
  }
}

async function loadPartners() {
  try {
    const { data, error } = await db.from('design_partners').select('*').order('created_at', { ascending: false });
    if (error) throw error;
    allPartners = data || [];
    renderPartners();
  } catch (e) {
    console.warn('Supabase error (partners):', e.message);
    allPartners = [];
    renderPartners();
  }
}

async function submitReport() {
  const role = document.getElementById('form-role').value;
  const outputs = document.getElementById('form-outputs').value.trim();
  const learnings = document.getElementById('form-learnings').value.trim();
  const blockers = document.getElementById('form-blockers').value.trim();
  const metrics = document.getElementById('form-metrics').value.trim();
  const commitments = document.getElementById('form-commitments').value.trim();

  if (!outputs) { showToast('‚ö† Outputs are required'); return; }

  const week = getCurrentWeekNumber();

  try {
    await db.from('founder_reports').insert([{ role, outputs, learnings, blockers, metrics, commitments, week }]);
    showToast('‚úì Report submitted');
    document.getElementById('form-outputs').value = '';
    document.getElementById('form-learnings').value = '';
    document.getElementById('form-blockers').value = '';
    document.getElementById('form-metrics').value = '';
    document.getElementById('form-commitments').value = '';
    await loadReports();
    switchTab('reports', document.querySelector('.tab'));
  } catch (e) {
    showToast('Error: ' + e.message);
  }
}

async function savePartner() {
  const name = document.getElementById('p-name').value.trim();
  const contact = document.getElementById('p-contact').value.trim();
  const notes = document.getElementById('p-notes').value.trim();

  if (!name) { showToast('‚ö† Company name required'); return; }
  if (!selectedStage) { showToast('‚ö† Select a stage'); return; }

  const stageColors = { 'Outreach': '#5a7085', 'Discovery Call': '#00aaff', 'Offer Sent': '#ffcc00', 'Signed': '#00ff88', 'Active': '#00ff88' };
  const color = stageColors[selectedStage] || '#5a7085';

  try {
    await db.from('design_partners').insert([{ name, contact, stage: selectedStage, notes, color }]);
    showToast('‚úì Partner added');
    closePartnerModal();
    await loadPartners();
    renderLaunchChecklist();
  } catch (e) {
    showToast('Error: ' + e.message);
  }
}

async function deletePartner(id) {
  try {
    await db.from('design_partners').delete().eq('id', id);
    await loadPartners();
    renderLaunchChecklist();
    showToast('Partner removed');
  } catch (e) {
    showToast('Error: ' + e.message);
  }
}

// ‚îÄ‚îÄ‚îÄ RENDER: DASHBOARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderDashboard() {
  renderHealthGrid();
  renderFounderCards();
  renderTrendChart();
  renderCommitments();
  renderBlockers();
}

function renderHealthGrid() {
  const thisWeekReports = allReports.filter(r => r.week === getCurrentWeekNumber());
  const roles = ['Filipe', 'Loa', 'Clinton'];
  const reportsByRole = {};
  roles.forEach(r => reportsByRole[r] = thisWeekReports.filter(rep => rep.role === r));

  const signedPartners = allPartners.filter(p => p.stage === 'Signed' || p.stage === 'Active').length;

  const metrics = [
    { name: 'Convos This Week', val: '‚Äî', target: '25 target', owner: 'Filipe', status: getStatus('‚Äî', 25, 'num') },
    { name: 'Reports Submitted', val: thisWeekReports.length + '/3', target: '3 required', status: thisWeekReports.length >= 3 ? 'green' : thisWeekReports.length >= 1 ? 'yellow' : 'red' },
    { name: 'Design Partners', val: signedPartners + '/5', target: '5 to launch', status: signedPartners >= 5 ? 'green' : signedPartners >= 2 ? 'yellow' : signedPartners >= 1 ? 'yellow' : 'red' },
    { name: 'Assets Shipped', val: '‚Äî', target: '2/week target', owner: 'Loa', status: 'yellow' },
    { name: 'Analyses Delivered', val: '‚Äî', target: '3/week target', owner: 'Clinton', status: 'yellow' },
    { name: 'Week', val: getCurrentWeekNumber() + '/12', target: 'Pre-launch', status: getCurrentWeekNumber() <= 12 ? 'green' : 'red' },
  ];

  const labels = { green: '‚óè ON TRACK', yellow: '‚óè AT RISK', red: '‚óè BEHIND' };

  document.getElementById('health-grid').innerHTML = metrics.map(m => `
    <div class="health-card ${m.status}">
      <div class="status-badge ${m.status}">${labels[m.status]}</div>
      <div class="health-metric-name">${m.name}</div>
      <div class="health-value">${m.val}</div>
      <div class="health-target">${m.target}</div>
    </div>
  `).join('');
}

function getStatus(val, target, type) {
  if (type === 'num') {
    if (val === '‚Äî') return 'yellow';
    const n = parseFloat(val);
    if (n >= target) return 'green';
    if (n >= target * 0.6) return 'yellow';
    return 'red';
  }
  return 'yellow';
}

function renderFounderCards() {
  const founders = [
    {
      name: 'Filipe', role: 'CRO ¬∑ REVENUE',
      metrics: [
        { label: 'Outbound Convos', target: '25/wk', val: getLatestMetric('Filipe', 'convo') },
        { label: 'Discovery Calls', target: '10/wk', val: getLatestMetric('Filipe', 'call') },
        { label: 'Reports Filed', target: 'weekly', val: getReportsCount('Filipe') },
        { label: 'Offers Made', target: '3/wk', val: '‚Äî' },
      ]
    },
    {
      name: 'Loa', role: 'CCO ¬∑ MARKET AUTHORITY',
      metrics: [
        { label: 'Assets Shipped', target: '2/wk', val: '‚Äî' },
        { label: 'Message Refinements', target: '3/wk', val: '‚Äî' },
        { label: 'Reports Filed', target: 'weekly', val: getReportsCount('Loa') },
        { label: 'Demo Updates', target: '1/wk', val: '‚Äî' },
      ]
    },
    {
      name: 'Clinton', role: 'COO ¬∑ OPERATIONS',
      metrics: [
        { label: 'Analyses Delivered', target: '3/wk', val: '‚Äî' },
        { label: 'Process Steps Docs', target: '3/wk', val: '‚Äî' },
        { label: 'Reports Filed', target: 'weekly', val: getReportsCount('Clinton') },
        { label: 'Onboarding Improv.', target: 'weekly', val: '‚Äî' },
      ]
    }
  ];

  document.getElementById('founder-grid').innerHTML = founders.map(f => `
    <div class="founder-card">
      <div class="founder-name">${f.name}</div>
      <div class="founder-role">${f.role}</div>
      ${f.metrics.map(m => `
        <div class="metric-row">
          <span class="label">${m.label}</span>
          <span class="val ${getValColor(m.val, m.target)}">${m.val}</span>
        </div>
      `).join('')}
    </div>
  `).join('');
}

function getLatestMetric(role, type) {
  const recent = allReports.filter(r => r.role === role)[0];
  if (!recent) return '‚Äî';
  return '‚Äî'; // Would parse from metrics text
}

function getReportsCount(role) {
  const thisWeek = allReports.filter(r => r.role === role && r.week === getCurrentWeekNumber()).length;
  return thisWeek > 0 ? '‚úì Filed' : '‚úó Missing';
}

function getValColor(val, target) {
  if (val === '‚úì Filed') return 'green';
  if (val === '‚úó Missing') return 'red';
  if (val === '‚Äî') return '';
  return 'green';
}

function renderTrendChart() {
  // Group reports by week
  const weeks = {};
  allReports.forEach(r => {
    const w = r.week || 1;
    if (!weeks[w]) weeks[w] = { Filipe: 0, Loa: 0, Clinton: 0 };
    if (weeks[w][r.role] !== undefined) weeks[w][r.role]++;
  });

  const currentWeek = getCurrentWeekNumber();
  const startWeek = Math.max(1, currentWeek - 5);
  const displayWeeks = [];
  for (let i = startWeek; i <= currentWeek; i++) displayWeeks.push(i);

  const allVals = displayWeeks.flatMap(w => [
    (weeks[w] || {}).Filipe || 0,
    (weeks[w] || {}).Loa || 0,
    (weeks[w] || {}).Clinton || 0
  ]);
  const maxVal = Math.max(1, ...allVals);

  const chartArea = document.getElementById('chart-area');
  const chartWeeks = document.getElementById('chart-weeks');

  chartArea.innerHTML = displayWeeks.map(w => {
    const d = weeks[w] || { Filipe: 0, Loa: 0, Clinton: 0 };
    return `
      <div class="bar-group">
        <div class="bar filipe" style="height:${Math.max(4, (d.Filipe / maxVal) * 110)}px" data-val="Filipe: ${d.Filipe}"></div>
        <div class="bar loa" style="height:${Math.max(4, (d.Loa / maxVal) * 110)}px" data-val="Loa: ${d.Loa}"></div>
        <div class="bar clinton" style="height:${Math.max(4, (d.Clinton / maxVal) * 110)}px" data-val="Clinton: ${d.Clinton}"></div>
      </div>
    `;
  }).join('');

  chartWeeks.innerHTML = displayWeeks.map(w => `<div class="week-label">W${w}</div>`).join('');
}

// ‚îÄ‚îÄ‚îÄ RENDER: REPORTS FEED ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderReports() {
  const container = document.getElementById('reports-feed');
  if (!allReports.length) {
    container.innerHTML = '<div class="empty-state"><div class="icon">üìã</div>No reports yet. Submit the first one.</div>';
    return;
  }

  container.innerHTML = allReports.map(r => {
    const date = new Date(r.created_at);
    const timeStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' ¬∑ W' + (r.week || '‚Äî');
    return `
      <div class="report-card">
        <div class="report-header">
          <div class="report-role ${r.role}">${r.role} <span style="color:var(--muted);font-size:12px;font-weight:400">${r.role === 'Filipe' ? '(CRO)' : r.role === 'Loa' ? '(CCO)' : '(COO)'}</span></div>
          <div class="report-time">${timeStr}</div>
        </div>
        ${r.outputs ? `<div class="report-field"><div class="report-field-label">Outputs</div><div class="report-field-value">${r.outputs}</div></div>` : ''}
        ${r.learnings ? `<div class="report-field"><div class="report-field-label">Learnings</div><div class="report-field-value">${r.learnings}</div></div>` : ''}
        ${r.blockers ? `<div class="report-field"><div class="report-field-label">Blockers</div><div class="report-field-value" style="color:var(--yellow)">${r.blockers}</div></div>` : ''}
        ${r.metrics ? `<div class="report-field"><div class="report-field-label">Metrics</div><div class="report-field-value">${r.metrics}</div></div>` : ''}
        ${r.commitments ? `<div class="report-field"><div class="report-field-label">Next Week</div><div class="report-field-value" style="color:var(--green)">${r.commitments}</div></div>` : ''}
      </div>
    `;
  }).join('');
}

// ‚îÄ‚îÄ‚îÄ RENDER: PARTNERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderPartners() {
  const slots = document.getElementById('partner-slots');
  const list = document.getElementById('partner-list');

  // Slots
  slots.innerHTML = Array.from({ length: 5 }, (_, i) => {
    const p = allPartners[i];
    if (p && (p.stage === 'Signed' || p.stage === 'Active')) {
      return `<div class="partner-slot filled">‚úì ${p.name.split(' ')[0]}</div>`;
    }
    return `<div class="partner-slot">${i + 1}</div>`;
  }).join('');

  // List
  if (!allPartners.length) {
    list.innerHTML = '<div class="empty-state"><div class="icon">üéØ</div>No design partners yet. Close the first deal.</div>';
    return;
  }

  const stageColors = { 'Outreach': 'var(--muted)', 'Discovery Call': 'var(--blue)', 'Offer Sent': 'var(--yellow)', 'Signed': 'var(--green)', 'Active': 'var(--green)' };

  list.innerHTML = allPartners.map(p => `
    <div class="partner-item">
      <div class="partner-status" style="background:${stageColors[p.stage] || 'var(--muted)'}"></div>
      <div class="partner-name">${p.name}</div>
      ${p.contact ? `<div class="partner-stage">${p.contact}</div>` : ''}
      <div class="partner-stage" style="color:${stageColors[p.stage] || 'var(--muted)'}">${p.stage}</div>
      <button class="btn-delete" onclick="deletePartner(${p.id})" title="Remove">‚úï</button>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ‚îÄ RENDER: ALERTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAlerts() {
  const alerts = [];
  const currentWeek = getCurrentWeekNumber();

  // Check for missing reports this week
  const thisWeekReports = allReports.filter(r => r.week === currentWeek);
  const reportedRoles = thisWeekReports.map(r => r.role);
  const allRoles = ['Filipe', 'Loa', 'Clinton'];

  allRoles.forEach(role => {
    if (!reportedRoles.includes(role)) {
      alerts.push({ icon: '‚ö†Ô∏è', text: `${role} has not submitted a report for Week ${currentWeek}`, meta: 'Report missing', severity: 'red' });
    }
  });

  // Check partners
  const signedCount = allPartners.filter(p => p.stage === 'Signed' || p.stage === 'Active').length;
  if (signedCount === 0 && currentWeek >= 4) {
    alerts.push({ icon: 'üö®', text: 'No signed design partners yet ‚Äî Week 4+ target requires first close', meta: 'Revenue blocker', severity: 'red' });
  }

  if (currentWeek >= 6 && signedCount < 2) {
    alerts.push({ icon: 'üìä', text: 'Week 6‚Äì7 target is 3 design partners ‚Äî currently behind', meta: 'Pace alert', severity: 'yellow' });
  }

  // Blockers from reports
  const recentBlockers = allReports.filter(r => r.blockers && r.blockers.trim() && r.week === currentWeek);
  recentBlockers.forEach(r => {
    alerts.push({ icon: 'üîß', text: `${r.role}: ${r.blockers}`, meta: `Week ${r.week} blocker`, severity: 'yellow' });
  });

  const container = document.getElementById('alerts-list');
  if (!alerts.length) {
    container.innerHTML = '<div class="empty-state" style="padding:16px 0;"><div class="icon" style="font-size:20px;">‚úÖ</div>No active alerts</div>';
    return;
  }

  container.innerHTML = alerts.map(a => `
    <div class="alert-item">
      <div class="alert-icon">${a.icon}</div>
      <div>
        <div class="alert-text">${a.text}</div>
        <div class="alert-meta" style="color:${a.severity === 'red' ? 'var(--red)' : 'var(--yellow)'}">${a.meta}</div>
      </div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ‚îÄ RENDER: COMMITMENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCommitments() {
  const weekNum = getCurrentWeekNumber() + currentWeekOffset;
  const weekReports = allReports.filter(r => r.week === weekNum && r.commitments);
  const container = document.getElementById('commitments-panel');

  if (!weekReports.length) {
    container.innerHTML = '<div class="empty-state" style="font-family:var(--font-mono);font-size:11px;color:var(--muted);text-align:center;padding:20px 0;">No commitments filed for this week yet</div>';
    return;
  }

  const storageKey = `revos_commits_w${weekNum}`;
  let checked = JSON.parse(localStorage.getItem(storageKey) || '{}');

  container.innerHTML = weekReports.map(r => {
    const lines = r.commitments.split('\n').filter(l => l.trim());
    return `
      <div class="commitment-block">
        <div class="commitment-name">${r.role.toUpperCase()}</div>
        ${lines.map((line, i) => {
          const key = `${r.id}_${i}`;
          const done = checked[key];
          return `
            <div class="commitment-item" onclick="toggleCommit('${storageKey}', '${key}', this)">
              <input type="checkbox" ${done ? 'checked' : ''} onclick="event.stopPropagation();toggleCommit('${storageKey}', '${key}', this.parentElement)">
              <div class="commitment-text ${done ? 'done' : ''}">${line.replace(/^[-‚Ä¢*]\s*/, '')}</div>
            </div>
          `;
        }).join('')}
      </div>
    `;
  }).join('');
}

function toggleCommit(storageKey, key, el) {
  let checked = JSON.parse(localStorage.getItem(storageKey) || '{}');
  checked[key] = !checked[key];
  localStorage.setItem(storageKey, JSON.stringify(checked));
  renderCommitments();
}

// ‚îÄ‚îÄ‚îÄ RENDER: BLOCKERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderBlockers() {
  const currentWeek = getCurrentWeekNumber();
  const activeBlockers = allReports.filter(r => r.blockers && r.blockers.trim() && r.week === currentWeek);
  const container = document.getElementById('blockers-board');

  if (!activeBlockers.length) {
    container.innerHTML = '<div style="font-family:var(--font-mono);font-size:11px;color:var(--muted);text-align:center;padding:16px 0;">No active blockers</div>';
    return;
  }

  container.innerHTML = activeBlockers.map(r => `
    <div style="background:rgba(255,204,0,0.05);border:1px solid rgba(255,204,0,0.2);border-radius:6px;padding:12px 14px;">
      <div style="font-family:var(--font-mono);font-size:10px;color:var(--yellow);margin-bottom:6px;letter-spacing:1px;">${r.role.toUpperCase()}</div>
      <div style="font-size:12px;color:var(--text);line-height:1.5;">${r.blockers}</div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ‚îÄ RENDER: LAUNCH CHECKLIST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderLaunchChecklist() {
  const signedPartners = allPartners.filter(p => p.stage === 'Signed' || p.stage === 'Active').length;
  const hasReports = allReports.length >= 3;

  const items = [
    { label: '5 companies paid', done: signedPartners >= 5 },
    { label: 'Before/after metrics documented', done: false },
    { label: 'Onboarding repeatable (3+ runs)', done: false },
    { label: 'Sales script proven to convert', done: false },
    { label: 'Compliance logic proven manually', done: false },
    { label: 'All 3 founders reporting weekly', done: hasReports },
    { label: 'Design partner close documented', done: signedPartners >= 1 },
    { label: 'Pricing finalized', done: false },
  ];

  const container = document.getElementById('launch-checklist');
  const doneCount = items.filter(i => i.done).length;

  container.innerHTML = `
    <div style="background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:20px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <div style="font-weight:700;">Engineer Hire Readiness</div>
        <div style="font-family:var(--font-mono);font-size:13px;color:${doneCount >= 7 ? 'var(--green)' : 'var(--yellow)'};">${doneCount}/${items.length}</div>
      </div>
      <div style="background:var(--border);border-radius:4px;height:4px;margin-bottom:20px;">
        <div style="background:var(--green);height:4px;border-radius:4px;width:${(doneCount / items.length) * 100}%;transition:width 0.5s;"></div>
      </div>
      ${items.map(item => `
        <div style="display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid var(--border);font-size:13px;">
          <span style="font-size:14px;${item.done ? 'color:var(--green)' : 'color:var(--muted)'}">${item.done ? '‚úì' : '‚óã'}</span>
          <span style="${item.done ? 'color:var(--text)' : 'color:var(--muted)'}">${item.label}</span>
        </div>
      `).join('')}
    </div>
  `;
}

// ‚îÄ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(name, btn) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + name).classList.add('active');
  if (btn) btn.classList.add('active');
  else document.querySelectorAll('.tab')[['dashboard','reports','submit','partners'].indexOf(name)].classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ PARTNER MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openPartnerModal() {
  document.getElementById('partner-modal').classList.add('active');
  selectedStage = '';
  document.getElementById('p-name').value = '';
  document.getElementById('p-contact').value = '';
  document.getElementById('p-notes').value = '';
  document.querySelectorAll('.stage-opt').forEach(b => b.classList.remove('active'));
}

function closePartnerModal() {
  document.getElementById('partner-modal').classList.remove('active');
}

function selectStage(el, stage) {
  selectedStage = stage;
  document.querySelectorAll('.stage-opt').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

// ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// ‚îÄ‚îÄ‚îÄ REAL-TIME SUBSCRIPTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function subscribeRealtime() {
  try {
    db.channel('revos-reports')
      .on('postgres_changes', { event: '*', schema: 'public', table: 'founder_reports' }, () => loadReports())
      .on('postgres_changes', { event: '*', schema: 'public', table: 'design_partners' }, () => loadPartners())
      .subscribe();
  } catch(e) {
    console.warn('Realtime subscription failed:', e.message);
  }
}

// ‚îÄ‚îÄ‚îÄ START ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
init();
subscribeRealtime();
</script>
</body>
</html>
